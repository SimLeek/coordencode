from pnums import PInt
import numpy as np


def test_create_1d():
    a = PInt(123456789, confidence=.6)
    np.testing.assert_array_almost_equal(
        [
            [0.4, 0.4, 0.4, 0.4, 0.4, 0.6, 0.6, 0.6, 0.4, 0.6, 0.4, 0.6, 0.6, 0.4, 0.6, 0.6, 0.6, 0.6, 0.4, 0.4, 0.6,
             0.6, 0.4, 0.6, 0.4, 0.4, 0.4, 0.6, 0.4, 0.6, 0.4, 0.6, ],
            [0.6, 0.6, 0.6, 0.6, 0.6, 0.4, 0.4, 0.4, 0.6, 0.4, 0.6, 0.4, 0.4, 0.6, 0.4, 0.4, 0.4, 0.4, 0.6, 0.6, 0.4,
             0.4, 0.6, 0.4, 0.6, 0.6, 0.6, 0.4, 0.6, 0.4, 0.6, 0.4, ]
        ],
        a.tensor.numpy()
    )


def test_create_2d():
    a = PInt(123, 234, bits=8, confidence=.6)
    np.testing.assert_array_almost_equal(
        [[[0.13333334, 0.6000, 0.6000, 0.13333334, 0.6000, 0.13333334, 0.6000, 0.13333334],
          [0.13333334, 0.13333334, 0.13333334, 0.6000, 0.13333334, 0.13333334, 0.13333334, 0.6000]],

         [[0.6000, 0.13333334, 0.13333334, 0.13333334, 0.13333334, 0.13333334, 0.13333334, 0.13333334],
          [0.13333334, 0.13333334, 0.13333334, 0.13333334, 0.13333334, 0.6000, 0.13333334, 0.13333334]]],
        a.tensor.numpy()
    )


def test_create_3d():
    a = PInt(14, 11, 7, bits=4, confidence=.6)
    np.testing.assert_array_almost_equal(
        [[[[0.05714286, 0.05714286, 0.6000, 0.05714286],
           [0.6000, 0.05714286, 0.05714286, 0.05714286]],

          [[0.05714286, 0.6000, 0.05714286, 0.05714286],
           [0.05714286, 0.05714286, 0.05714286, 0.05714286]]],

         [[[0.05714286, 0.05714286, 0.05714286, 0.6000],
           [0.05714286, 0.05714286, 0.05714286, 0.05714286]],

          [[0.05714286, 0.05714286, 0.05714286, 0.05714286],
           [0.05714286, 0.05714286, 0.05714286, 0.05714286]]]],
        a.tensor.numpy()
    )


def test_add_1d():
    a = PInt(10, bits=5, confidence=.8)
    b = PInt(6, bits=5, confidence=.9)
    c = a + b
    np.testing.assert_array_almost_equal(
        [[0.72,       0.24000013, 0.0800001, 0.28,       0.26],
         [0.27999997, 0.7599999,  0.9199999, 0.71999997, 0.73999995]],
        c.tensor
    )

def test_add_2d():
    a = PInt(10, 11, bits=6, confidence=.8)
    b = PInt(6, 13, bits=6, confidence=.9)
    c = a + b
    np.testing.assert_array_almost_equal(
        [[0.72,       0.24000013, 0.0800001, 0.28,       0.26],
         [0.27999997, 0.7599999,  0.9199999, 0.71999997, 0.73999995]],
        c.tensor
    )
